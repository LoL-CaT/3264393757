{"splash"
	{on show
		{set "$center" 0x10000000} ; magic from engine
		{set "$fade_time_splash" 0.2}
		{set "$fade_time_text" 1.3}
		{set "$wait_time" 4.0}
		{set "$text_style" {lt "splash/style"}}
		{set "$music" "/interface/pages/splash/0"}
		{music "$music" play}
		{set able_next false}
		{set able_back true}
		{set "$stage" 0}
		{delay 1 "start"
			{call "next_stage"}
		}
		{picture "logo" "/interface/pages/splash/0"}; preload last picture
		{dialog_close "logo"}
	}
	{on "back"
		{if able_back
			{call "start_stage_last"}
		}
	}
	{on "next_stage"
		{set "$stage" {add "$stage" 1}}
		{if {less "$stage" 3}
			{call "start_stage_splash"}
		elif {eq "$stage" 3}
			{call "start_stage_wait"}
		elif {less "$stage" 7}
			{call "start_stage_text"}
		else
			{call "start_stage_last"}
		}
	}
	{on "start_stage_splash"
		{set able_next false}
		{set fade_in true}
		{set fade_out false}
		{if {eq "$stage" 1}
			{picture "logo" "/interface/pages/splash/fq"
				{dda "stretch" true}
				{dda_call "set_zoom" "fit"}
			}
		elif {eq "$stage" 2}
			{picture "logo" "/interface/pages/splash/bw"
				{dda "stretch" true}
				{dda_call "set_zoom" "fit"}
			}
		elif {eq "$stage" 7}
			{picture "logo" "/interface/pages/splash/0"
				{dda "stretch" true}
				{dda_call "set_zoom" "fit"}
			}
		}
		{set "$start_time" {time}}
		{call "fade_splash"}
	}
	{on key "KEY_SPACE"
		{if able_next
			{call "wait_end"}
		}
	}
	{on mouse_left
		{if able_next
			{call "wait_end"}
		}
	}
	{on mouse_right
		{call "back"}
	}
	{on resize
		{with "logo"
			{dda_call "set_zoom" "fit"}
		}
		{call "locate_texts"}
	}
	{on "fade_splash"
		{if {or fade_in fade_out}
			{set "$passed_time" {sub {time} "$start_time"}}
			{if {less "$passed_time" "$fade_time_splash"}
				{with "logo"
					{if fade_in
						{dda "visibility" {div "$passed_time" "$fade_time_splash"}}
					else
						{dda "visibility" {sub 1.0 {div "$passed_time" "$fade_time_splash"}}}
					}
				}
				{delay_effect 0 "fade_splash"}
			else
				{if fade_in
					{with "logo"
						{dda "visibility" 1.0}
					}
					{if {eq "$stage" 7}
						{delay 0.5
							{dda_call "page_back"} ; do not use {page_back} here because of FEW packages ready fail when starting
						}
					else
						{set able_next true}
						{delay_effect "$wait_time" "wait_end"}
					}
				else
					{dialog_close "logo"}
					{call "next_stage"}
				}
			}
		}
	}
	{on "wait_end"
		{kill_delay "wait_end"}
		{set able_next false}
		{set fade_in false}
		{set fade_out true}
		{set "$start_time" {time}}
		{if {less "$stage" 3}
			{call "fade_splash"}
		else
			{call "next_stage"}
		}
	}
	{on "start_stage_wait"
		{set able_next true}
		{delay_effect "$wait_time" "wait_end"}
	}
	{on "start_stage_text"
		{set able_next false}
		{set fade_in true}
		{set fade_out false}
		{set "$text" {add "text" {itos {sub "$stage" 3}}}}
		{dialog "text"
			{id "$text"}
		}
		{call "locate_texts"}
		{set "$start_time" {time}}
		{call "fade_text"}
	}
	{on "locate_texts"
		{set "$height" {height}} ; height of page
		{with "text1"
			{text {add "$text_style" {lt "splash/text1"}}}
			{size -1 -1}
			{set "$line_height" {height}}
			{size_increase_percent 0.0 10.0} ; compensate font height for some letters like 'g'
			{location "$center" {sub {div "$height" 2} {mul "$line_height" 4} {div "$line_height" 2}}}
			{text_format "$text_style" "center"}
		}
		{with "text2"
			{text {add "$text_style" {lt "splash/text2"}}}
			{size -1 -1}
			{location "$center" {sub {div "$height" 2} "$line_height" {div "$line_height" 2}}}
			{size_increase_percent 0.0 10.0}
			{text_format "$text_style" "center"}
		}
		{with "text3"
			{text {add "$text_style" {lt "splash/text3"}}}
			{size -1 -1} {size_increase_percent 0.0 10.0}
			{location "$center" {sub {add {div "$height" 2} {mul "$line_height" 3}} {div "$line_height" 2}}}
			{text_format "$text_style" "center"}
		}
	}
	{on "fade_text"
		{set "$passed_time" {sub {time} "$start_time"}}
		{if {less "$passed_time" "$fade_time_text"}
			{with "$text"
				{dda "visibility" {div "$passed_time" "$fade_time_text"}}
			}
			{delay_effect 0 "fade_text"}
		else
			{set able_next true}
			{with "$text"
				{dda "visibility" 1.0}
			}
			{delay_effect "$wait_time" "wait_end"}
		}
	}
	{on "start_stage_last"
		{music "$music" stop 0.7}
		{set "$stage" 7}
		{set able_back false}
		{kill_delay "start"}
		{kill_delay "wait_end"}
		{dialog_close "text1"}
		{dialog_close "text2"}
		{dialog_close "text3"}
		{call "start_stage_splash"}
	}
}
